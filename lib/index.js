// Generated by CoffeeScript 1.3.1
var jar;

jar = typeof exports !== "undefined" && exports !== null ? exports : (this['jar'] = {});

jar.Jar = (function() {

  Jar.name = 'Jar';

  function Jar() {}

  Jar.prototype.parse = function() {
    var cookie, m, _i, _len, _ref;
    this.cookies = {};
    _ref = this._getCookies().split(/;\s/g);
    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
      cookie = _ref[_i];
      m = cookie.match(/([^=]+)=(.*)/);
      if (Array.isArray(m)) {
        this.cookies[m[1]] = m[2];
      }
    }
  };

  Jar.prototype.encode = function(value) {
    return encodeURIComponent(JSON.stringify(value));
  };

  Jar.prototype.decode = function(value) {
    return JSON.parse(decodeURIComponent(value));
  };

  Jar.prototype.get = function(name) {
    if (!this.cookies) {
      this.parse();
    }
    try {
      return this.decode(this.cookies[name]);
    } catch (e) {

    }
  };

  Jar.prototype.set = function(name, value, options) {
    var cookie, date, domain, expires, path, secure;
    if (options == null) {
      options = {};
    }
    if (!this.cookies) {
      this.parse();
    }
    if (value === null) {
      value = '';
      options.expires = -(60 * 60 * 24);
    }
    if (options.expires) {
      if (typeof options.expires === 'number') {
        date = new Date();
        date.setTime(date.getTime() + (options.expires * 1000));
        options.expires = date;
      }
      if (options.expires instanceof Date) {
        options.expires = options.expires.toUTCString();
      }
    }
    expires = (options.expires ? "; expires=" + options.expires : '');
    path = (options.path ? "; path=" + options.path : '');
    domain = (options.domain ? "; domain=" + options.domain : '');
    secure = (options.secure ? '; secure' : '');
    if (!('raw' in options) || !options.raw) {
      value = this.encode(value);
    }
    cookie = [name, '=', value, expires, path, domain, secure].join('');
    this._setCookie(cookie);
    return this.cookies[name] = value;
  };

  return Jar;

})();

if (typeof process !== "undefined" && process !== null ? process.pid : void 0) {
  require('./node');
}
